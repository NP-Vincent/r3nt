<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>r3nt — Platform Owner Console</title>
  <link rel="stylesheet" href="./styles/theme.css" />

  <script src="./js/dev-settings.js"></script>
  <script src="./js/dev-error-console.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://c0f4f41c-2f55-4863-921b-sdk-docs.github.io/cdn/metamask-sdk.js"></script>
</head>
<body class="page-narrow">
  <header>
    <div class="brand">r3nt by SQMU</div>
  </header>

  <div class="muted beta-note">early beta.</div>

  <nav>
    <a href="./index.html">Home</a>
    <a href="./tenant.html">Tenant</a>
    <a href="./landlord.html">Landlord</a>
    <a href="./investor.html">Investor</a>
    <a href="./agent.html">Agent</a>
    <span class="version-badge" data-version></span>
  </nav>
  <div id="notificationTray" class="notification-tray"></div>
  <header data-owner-only hidden>
    <h1>Platform Owner Console</h1>
    <p class="muted">Direct access for the r3nt platform multi-sig. Review the live configuration before submitting changes.</p>
    <div class="muted">Build <span data-version></span></div>
  </header>

  <section class="card">
    <h2>Connection</h2>
    <p class="muted">Connect wallet first. The interface will insist on Arbitrum One.</p>
    <div class="button-row">
      <button id="connectBtn">Connect MetaMask</button>
      <button id="disconnectBtn" class="secondary" disabled>Disconnect</button>
      <button id="refreshSnapshotBtn" class="secondary" disabled>Refresh snapshot</button>
    </div>
    <div class="note" id="walletStatus">Not connected.</div>
    <div class="note" id="ownerGuardMessage">Owner wallet required to unlock controls.</div>
    <div class="muted" id="connectedAccount"></div>
  </section>

  <section class="card" data-owner-only hidden>
    <h2>Platform snapshot</h2>
    <p class="muted">Use this read-only summary to confirm the on-chain configuration before and after updates.</p>
    <pre id="snapshotOutput">Loading current state…</pre>
  </section>

  <section class="card" id="depositSection" data-owner-only hidden>
    <h2>Deposit releases</h2>
    <p class="muted">Review landlord proposals and confirm the final split using the platform owner wallet.</p>
    <label>Listing ID (starts at 1)
      <input id="depositListingId" inputmode="numeric" autocomplete="off" placeholder="1" />
    </label>
    <label>Booking ID
      <input id="depositBookingId" inputmode="numeric" autocomplete="off" placeholder="1" />
    </label>
    <div class="button-row">
      <button id="depositLoadBtn" type="button" class="secondary">Load booking</button>
    </div>
    <div class="note" id="depositInfo">Enter a listing &amp; booking ID, then load the booking to inspect its deposit status.</div>
    <div class="muted" id="depositStatus"></div>
    <form id="formConfirmDeposit" data-requires-signer>
      <p class="inline-label">Enabled once a pending split exists and the owner wallet is connected.</p>
      <div class="button-row">
        <button id="confirmDepositBtn" type="submit" class="danger">Confirm deposit release</button>
      </div>
    </form>
  </section>

  <section class="card" id="castHashSection" data-owner-only hidden>
    <h2>Listing cast hash</h2>
    <p class="muted">Update the stored Farcaster cast hash for an active listing. Accepts a Warpcast URL or raw 0x hash.</p>
    <form id="formUpdateCastHash" data-requires-signer>
      <label>Listing ID (starts at 1)
        <input id="castHashListingId" inputmode="numeric" autocomplete="off" placeholder="1" required />
      </label>
      <label>Cast hash or Warpcast URL
        <input id="castHashInput" autocomplete="off" placeholder="https://warpcast.com/…" required />
      </label>
      <button type="submit">Update listing cast hash</button>
    </form>
  </section>

  <section class="card" id="coreConfigSection" data-owner-only hidden>
    <h2>Core configuration</h2>
    <p class="muted">Addresses must be checksum formatted (0x-prefixed). Fees use basis points (1% = 100 bps). Totals cannot exceed 10,000 bps.</p>

    <form id="formUpdateUsdc" data-requires-signer>
      <h3>Set USDC token</h3>
      <p class="inline-label">Expects the canonical ERC-20 USDC address. Changing this will break transfers if set incorrectly.</p>
      <label>USDC contract address
        <input id="usdcAddress" placeholder="0x…" autocomplete="off" required />
      </label>
      <button type="submit">Update USDC</button>
    </form>

    <hr class="section-divider" />

    <form id="formUpdateTreasury" data-requires-signer>
      <h3>Set treasury</h3>
      <p class="inline-label">Protocol fees flow to this wallet.</p>
      <label>Treasury address
        <input id="treasuryAddress" placeholder="0x…" autocomplete="off" required />
      </label>
      <button type="submit">Update treasury</button>
    </form>

    <hr class="section-divider" />

    <form id="formUpdateModules" data-requires-signer>
      <h3>Module addresses</h3>
      <p class="inline-label">All three fields are required. Use deployed implementation addresses.</p>
      <label>ListingFactory address
        <input id="moduleFactory" placeholder="0x…" autocomplete="off" required />
      </label>
      <label>BookingRegistry address
        <input id="moduleRegistry" placeholder="0x…" autocomplete="off" required />
      </label>
      <label>r3nt-SQMU (SQMU-R) token address
        <input id="moduleSqmu" placeholder="0x…" autocomplete="off" required />
      </label>
      <button type="submit">Set modules</button>
    </form>

    <hr class="section-divider" />

    <form id="formUpdateFees" data-requires-signer>
      <h3>Platform fees</h3>
      <p class="inline-label">Enter whole numbers in basis points. Example: 150 = 1.5%. Tenant + landlord fees must stay within 10,000 bps.</p>
      <label>Tenant fee (bps)
        <input id="tenantFee" inputmode="numeric" autocomplete="off" required />
      </label>
      <label>Landlord fee (bps)
        <input id="landlordFee" inputmode="numeric" autocomplete="off" required />
      </label>
      <button type="submit">Update fees</button>
    </form>

    <hr class="section-divider" />

    <form id="formUpdatePricing" data-requires-signer>
      <h3>Listing &amp; view pricing</h3>
      <p class="inline-label">USDC values accept up to 6 decimals. Set duration to <code>0</code> to disable view passes.</p>
      <label>Listing creation fee (USDC)
        <input id="listingFee" inputmode="decimal" autocomplete="off" placeholder="0.00" required />
      </label>
      <label>View pass price (USDC)
        <input id="viewPrice" inputmode="decimal" autocomplete="off" placeholder="0.00" required />
      </label>
      <label>View pass duration (hours)
        <input id="viewDuration" inputmode="numeric" autocomplete="off" placeholder="0" required />
      </label>
      <button type="submit">Update pricing</button>
    </form>
  </section>

  <section class="card" id="agentConfigSection" data-owner-only hidden>
    <h2>Agent controls</h2>
    <p class="muted">Deployers must be pre-approved before they can request agent proxies. Operators manage the deployed agent wallets.</p>

    <form id="formAgentImplementation" data-requires-signer>
      <h3>Agent implementation</h3>
      <p class="inline-label">Proxy implementation used when deploying new agents.</p>
      <label>Implementation address
        <input id="agentImplementation" placeholder="0x…" autocomplete="off" required />
      </label>
      <button type="submit">Set implementation</button>
    </form>

    <hr class="section-divider" />

    <form id="formAgentMaxFee" data-requires-signer>
      <h3>Agent fee cap</h3>
      <p class="inline-label">Maximum fee in basis points that any agent can charge (0 – 10,000).</p>
      <label>Max agent fee (bps)
        <input id="agentMaxFee" inputmode="numeric" autocomplete="off" required />
      </label>
      <button type="submit">Update cap</button>
    </form>

    <hr class="section-divider" />

    <form id="formAgentDeployer" data-requires-signer>
      <h3>Approve deployers</h3>
      <p class="inline-label">Grant or revoke permission for an address to deploy agent proxies.</p>
      <label>Account address
        <input id="agentDeployerAddress" placeholder="0x…" autocomplete="off" required />
      </label>
      <label>Permission
        <select id="agentDeployerFlag">
          <option value="true">Approve</option>
          <option value="false">Revoke</option>
        </select>
      </label>
      <button type="submit">Update deployer access</button>
    </form>

    <hr class="section-divider" />

    <form id="formAgentOperator" data-requires-signer>
      <h3>Approve operators</h3>
      <p class="inline-label">Operators must be approved before they can manage newly created agent proxies.</p>
      <label>Operator address
        <input id="agentOperatorAddress" placeholder="0x…" autocomplete="off" required />
      </label>
      <label>Permission
        <select id="agentOperatorFlag">
          <option value="true">Approve</option>
          <option value="false">Revoke</option>
        </select>
      </label>
      <button type="submit">Update operator access</button>
    </form>

    <hr class="section-divider" />

    <form id="formCreateAgent" data-requires-signer>
      <h3>Deploy agent proxy</h3>
      <p class="inline-label">Requires an existing booking on a registered listing. Agent fee must respect the global cap.</p>
      <label>Listing address
        <input id="createAgentListing" placeholder="0x…" autocomplete="off" required />
      </label>
      <label>Booking ID (integer)
        <input id="createAgentBooking" inputmode="numeric" autocomplete="off" required />
      </label>
      <label>Agent wallet (operator)
        <input id="createAgentWallet" placeholder="0x…" autocomplete="off" required />
      </label>
      <label>Agent fee (bps)
        <input id="createAgentFee" inputmode="numeric" autocomplete="off" required />
      </label>
      <label>Fee recipient (optional)
        <input id="createAgentRecipient" placeholder="0x… or leave blank" autocomplete="off" />
      </label>
      <button type="submit">Create agent</button>
    </form>
  </section>

  <section class="card" id="developerToolsSection" data-owner-only hidden>
    <h2>Developer tools</h2>
    <p class="muted">Toggle the in-app development console when debugging front-end errors. Disable it during normal operations.</p>
    <div class="button-row">
      <button id="toggleDevConsoleBtn" type="button" class="secondary">Enable dev console</button>
      <span class="muted" id="devConsoleStatus">Dev console is disabled.</span>
    </div>
  </section>

  <section class="card" data-owner-only hidden>
    <h2>Activity</h2>
    <p class="muted">Status updates for submitted transactions appear here.</p>
    <div id="actionStatus" class="muted">No activity yet.</div>
  </section>

  <footer>
    r3nt by SQMU. USDC. Arbitrum.
  </footer>

  <script type="module" src="./js/platform.js"></script>
</body>
</html>
