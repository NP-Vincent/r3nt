<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>r3nt — Create Listing</title>

  <!-- Farcaster Mini App embed -->
  <meta name="fc:miniapp" content='{
    "version":"1",
    "imageUrl":"https://r3nt.sqmu.net/assets/icon.png",
    "button":{
      "title":"Open r3nt",
      "action":{
        "type":"launch_miniapp",
        "name":"r3nt",
        "url":"https://r3nt.sqmu.net/index.html",
        "splashImageUrl":"https://r3nt.sqmu.net/assets/splashscreen.png",
        "splashBackgroundColor":"#FFFFFF"
      }
    }
  }' />

  <style>
    :root { --fg:#0f172a; --bg:#ffffff; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; max-width: 460px; margin: 0 auto; padding: 16px 16px 40px; background: var(--bg); color: var(--fg); }
    header { margin-bottom: 16px; }
    .brand { font-weight: 800; letter-spacing: .3px; font-size: 1.3rem; }
    .beta-note { font-size: .9rem; margin: -12px 0 16px; }
    h1 { font-size: 1.25rem; margin: 8px 0 12px; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; }
    label { display: block; font-size: .9rem; margin: 10px 0 6px; }
    input { width: 100%; padding: 10px 12px; border: 1px solid #d0d7de; border-radius: 8px; font-size: .95rem; }
    small.mono { font-family: ui-monospace, Menlo, monospace; color:#666; }
    button { width: 100%; padding: 12px 16px; border: 0; border-radius: 10px; font-weight: 700; cursor: pointer; }
    button:disabled { opacity: .6; cursor: not-allowed; }
    #connect { background: #1f6feb; color: #fff; margin: 8px 0; }
    #create  { background: #10b981; color: #fff; margin: 8px 0; }
    .pill { display:inline-block; padding:2px 8px; background:#eef2ff; color:#3730a3; border-radius:999px; font-size:.8rem; }
    #status { min-height: 22px; margin-top: 10px; font-size: .95rem; color:#444; line-height:1.4; word-break:break-word; }
    .muted { color:#666; }
    .divider { height:1px; background:#eee; margin:14px 0; }
    nav { margin-bottom:16px; display:flex; align-items:center; flex-wrap:wrap; gap:10px; }
    nav a { color:#1f6feb; text-decoration:none; font-weight:600; }
    .back-button { appearance:none; border:1px solid #d0d7de; background:#fff; color:#1f2937; padding:8px 12px; border-radius:999px; font-weight:600; display:inline-flex; align-items:center; gap:6px; cursor:pointer; }
    .back-button span { font-size:1rem; line-height:1; }
    .back-button[hidden] { display:none; }
    .back-button:focus-visible { outline:2px solid #1f6feb; outline-offset:2px; }
    .version-badge { display:inline-block; margin-left:8px; padding:2px 6px; border-radius:8px; font-size:.65rem; letter-spacing:.08em; text-transform:uppercase; background:#e2e8f0; color:#475569; }
    #landlordListings { margin-top:12px; display:flex; flex-direction:column; gap:12px; }
    .listing-controls { display:flex; flex-wrap:wrap; gap:10px; align-items:flex-end; margin-top:12px; }
    .listing-controls label { display:flex; flex-direction:column; gap:6px; margin:0; font-size:.85rem; color:#475569; }
    .listing-controls label span { font-weight:600; color:#1f2937; }
    .listing-controls select,
    .listing-controls input { width:auto; min-width:160px; padding:8px 10px; border:1px solid #d0d7de; border-radius:8px; font-size:.9rem; background:#fff; color:#0f172a; }
    .listing-controls button.inline-button { align-self:flex-end; }
    .landlord-card {
      border:1px solid #e5e7eb;
      border-radius:12px;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:12px;
      line-height:1.4;
      word-break:break-word;
    }
    .landlord-card-summary { display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .landlord-card-summary-main { flex:1; display:flex; flex-direction:column; gap:4px; cursor:pointer; }
    .landlord-card-summary-main:focus-visible { outline:2px solid #2563eb; outline-offset:2px; border-radius:10px; }
    .landlord-card-id { font-weight:600; color:#111827; font-size:1rem; }
    .landlord-card-meta { display:flex; flex-wrap:wrap; gap:8px; font-size:.85rem; color:#475569; }
    .landlord-card-meta span { display:inline-flex; align-items:center; gap:4px; }
    .landlord-card-summary-actions { display:flex; align-items:center; gap:6px; }
    .icon-button {
      width:32px;
      height:32px;
      border-radius:50%;
      border:1px solid #cbd5f5;
      background:#eef2ff;
      color:#1e3a8a;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size:1rem;
      cursor:pointer;
    }
    .icon-button:hover { background:#e0e7ff; }
    .icon-button:focus-visible { outline:2px solid #2563eb; outline-offset:2px; }
    .icon-button:disabled { opacity:.55; cursor:not-allowed; }
    .landlord-card-toggle { font-size:1rem; line-height:1; }
    .landlord-card-details { display:flex; flex-direction:column; gap:8px; margin-top:4px; }
    .landlord-card-details[hidden] { display:none; }
    .landlord-card-detail { font-size:.9rem; margin:0; line-height:1.4; }
    .landlord-card-address {
      font-family:ui-monospace, SFMono-Regular, SFMono, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
      font-size:.85rem;
      color:#334155;
      word-break:break-all;
    }
    #landlordListings .row { margin-top:8px; flex-wrap:wrap; }
    #landlordListings .row label { flex:1 1 160px; min-width:160px; }
    button.check-availability { background:#64748b; color:#fff; margin-top:8px; }
    .availability-result { margin-top:6px; font-size:.9rem; color:#444; }
    .availability-result.available { color:#047857; }
    .availability-result.unavailable,
    .availability-result.error { color:#dc2626; }
    a.listing-link { display:inline-block; margin-top:8px; color:#1f6feb; font-weight:600; text-decoration:none; }
    a.listing-link:hover { text-decoration:underline; }
    .notification-tray { position:sticky; top:0; display:flex; flex-direction:column; gap:8px; margin:0 0 12px; z-index:2; }
    .notification { display:flex; align-items:flex-start; justify-content:flex-start; gap:8px; flex-wrap:wrap; padding:10px 12px; border-radius:12px; border:1px solid #cbd5f5; background:#eef2ff; color:#1e3a8a; }
    .notification.notification-success { border-color:#bbf7d0; background:#ecfdf5; color:#065f46; }
    .notification.notification-error { border-color:#fecaca; background:#fef2f2; color:#7f1d1d; }
    .notification.notification-warning { border-color:#fef08a; background:#fffbeb; color:#92400e; }
    .notification-message { flex:1 1 100%; margin:0; font-size:.9rem; line-height:1.4; word-break:break-word; }
    .notification-close { background:transparent; border:0; color:inherit; font-size:1.1rem; cursor:pointer; padding:0 4px; margin-left:auto; }
    .onboarding-guide { border:1px solid #e2e8f0; border-radius:16px; background:#f8fafc; padding:16px; margin:12px 0 18px; }
    .onboarding-guide h2 { margin:0 0 6px; font-size:1.1rem; }
    .onboarding-guide p { margin:0; font-size:.9rem; color:#475569; }
    .checklist { list-style:none; margin:12px 0 0; padding:0; display:flex; flex-direction:column; gap:10px; }
    .checklist li { display:flex; gap:10px; align-items:flex-start; padding:10px 12px; border:1px solid #e2e8f0; border-radius:12px; background:#fff; transition:border-color .15s ease, background .15s ease; }
    .checklist li.complete { border-color:#bbf7d0; background:#ecfdf5; }
    .status-dot { width:12px; height:12px; border-radius:50%; background:#cbd5f5; margin-top:4px; flex-shrink:0; }
    .checklist li.complete .status-dot { background:#10b981; }
    .checklist strong { font-size:.95rem; display:block; }
    .checklist small { font-size:.8rem; color:#64748b; display:block; margin-top:2px; }
    .onboarding-hints { margin-top:12px; font-size:.9rem; color:#475569; }
    .guided-section { border:1px solid #e2e8f0; border-radius:16px; background:#fff; padding:16px; margin-top:18px; }
    .guided-section h3 { margin:0 0 6px; font-size:1.05rem; }
    .guided-section p.section-subtext { margin:0 0 12px; font-size:.85rem; color:#64748b; }
    .field-grid { display:grid; gap:12px; margin-top:12px; }
    .field-grid.columns-2 { grid-template-columns:repeat(auto-fit, minmax(240px, 1fr)); }
    .field-grid.columns-3 { grid-template-columns:repeat(auto-fit, minmax(180px, 1fr)); }
    .field-option { display:flex; align-items:flex-start; gap:12px; padding:12px 14px; border:1px solid #e2e8f0; border-radius:14px; background:#fff; transition:border-color .15s ease, box-shadow .15s ease, background .15s ease; }
    .field-option .status-dot { margin-top:6px; background:#cbd5f5; }
    .field-option:focus-within { border-color:#3b82f6; box-shadow:0 0 0 3px rgba(59,130,246,0.12); background:#f8fafc; }
    .field-option:focus-within .status-dot { background:#2563eb; }
    .field-content { display:flex; flex-direction:column; gap:8px; flex:1; }
    .field-title { font-weight:600; font-size:.95rem; color:#0f172a; }
    .field-hint { font-size:.8rem; color:#64748b; line-height:1.4; }
    .field-option input,
    .field-option select { width:100%; padding:10px 12px; border:1px solid #d0d7de; border-radius:10px; font-size:.95rem; background:#f8fafc; color:#0f172a; transition:border-color .15s ease, box-shadow .15s ease, background .15s ease; }
    .field-option input:focus,
    .field-option select:focus { outline:none; border-color:#2563eb; box-shadow:0 0 0 3px rgba(37,99,235,0.12); background:#fff; }
    .field-inline { display:flex; gap:8px; align-items:center; }
    .field-inline input { flex:1 1 auto; }
    button.inline-button { width:auto; padding:10px 12px; background:#0ea5e9; color:#fff; font-size:.85rem; border-radius:8px; border:0; }
    button.inline-button:disabled { opacity:.6; cursor:not-allowed; }
    button.inline-button.location-detect { background:#6366f1; }
    .location-tip { margin-top:8px; font-size:.8rem; }
    .location-tip a { color:#1f6feb; text-decoration:underline; }
    footer { margin-top:32px; padding-top:12px; border-top:1px solid var(--stroke, #e2e8f0); font-size:.9rem; color:var(--muted, #475569); text-align:center; }
  </style>
  <script src="./js/dev-settings.js"></script>
  <script src="./js/dev-error-console.js"></script>
</head>
<body>
  <header>
    <div class="brand">r3nt by SQMU</div>
  </header>

  <div class="muted beta-note">early beta.</div>

  <nav>
    <button type="button" class="back-button" data-back-button hidden aria-label="Go back">
      <span aria-hidden="true">←</span>
      Back
    </button>
    <a href="./index.html">Home</a>
    <a href="./tenant.html">Tenant</a>
    <a href="./landlord.html">Landlord</a>
    <a href="./investor.html">Investor</a>
    <a href="./agent.html">Agent</a>
    <a href="./admin.html">Admin</a>
    <span class="version-badge" data-version></span>
  </nav>
  <div id="notificationTray" class="notification-tray"></div>
  <h1>r3nt — Create Listing</h1>

  <div id="contextBar" class="muted">Starting…</div>
  <div id="feeInfo" class="muted">Listing price: — USDC</div>

  <button id="connect" disabled>Connect Wallet</button>

  <!-- Removed manual Cast URL/Hash field. We will compose and capture the hash automatically. -->

  <section class="onboarding-guide">
    <h2>Guided property onboarding</h2>
    <p>Complete each checkpoint to unlock Create Listing. We keep track of the essentials for you.</p>
    <ul class="checklist" id="onboardingChecklist">
      <li data-check="basics">
        <span class="status-dot"></span>
        <div>
          <strong>Basics</strong>
          <small>Set the title and short description.</small>
        </div>
      </li>
      <li data-check="location">
        <span class="status-dot"></span>
        <div>
          <strong>Location & size</strong>
          <small>Add latitude, longitude and square metre area.</small>
        </div>
      </li>
      <li data-check="pricing">
        <span class="status-dot"></span>
        <div>
          <strong>Pricing</strong>
          <small>Deposit plus at least one rent installment.</small>
        </div>
      </li>
      <li data-check="policies">
        <span class="status-dot"></span>
        <div>
          <strong>Policies</strong>
          <small>Minimum notice and booking window configured.</small>
        </div>
      </li>
    </ul>
    <div id="onboardingHints" class="onboarding-hints muted">Start with the basics — headline and short description.</div>
  </section>

  <div class="guided-section">
    <h3>1. Property basics</h3>
    <p class="section-subtext">We use these details to generate your Farcaster cast and metadata.</p>
    <div class="field-grid columns-2">
      <label class="field-option">
        <span class="status-dot" aria-hidden="true"></span>
        <div class="field-content">
          <span class="field-title">Latitude</span>
          <span class="field-hint">Decimal degrees, e.g. 25.2048</span>
          <input id="lat" placeholder="25.2048" inputmode="decimal">
        </div>
      </label>
      <label class="field-option">
        <span class="status-dot" aria-hidden="true"></span>
        <div class="field-content">
          <span class="field-title">Longitude</span>
          <span class="field-hint">Decimal degrees, e.g. 55.2708</span>
          <div class="field-inline">
            <input id="lon" placeholder="55.2708" inputmode="decimal">
            <button type="button" id="useLocation" class="inline-button location-detect">Use my current location</button>
          </div>
        </div>
      </label>
    </div>
    <div class="muted location-tip" id="locationTip"><small>Need coordinates? <a href="https://support.google.com/maps/answer/18539" target="_blank" rel="noopener">Right-click → “What’s here?” in Google Maps</a>.</small></div>
    <div class="field-grid">
      <label class="field-option">
        <span class="status-dot" aria-hidden="true"></span>
        <div class="field-content">
          <span class="field-title">GeoHash</span>
          <span class="field-hint">We derive this automatically. Paste one to update the coordinates.</span>
          <input id="geohash" placeholder="thrr3sq" autocapitalize="off" spellcheck="false">
        </div>
      </label>
    </div>
    <div class="muted"><small>We derive a GeoHash locally from these coordinates.</small></div>

    <div class="field-grid">
      <label class="field-option">
        <span class="status-dot" aria-hidden="true"></span>
        <div class="field-content">
          <span class="field-title">Title (max 64 chars)</span>
          <span class="field-hint">Appears as the property headline inside your cast.</span>
          <input id="title" maxlength="64" placeholder="Cozy studio near metro">
        </div>
      </label>

      <label class="field-option">
        <span class="status-dot" aria-hidden="true"></span>
        <div class="field-content">
          <span class="field-title">Short description (max 140 chars)</span>
          <span class="field-hint">Short summary shown on previews and share cards.</span>
          <input id="shortDesc" maxlength="140" placeholder="Furnished, walk to metro, fast Wi‑Fi">
        </div>
      </label>
    </div>
  </div>

  <div class="guided-section">
    <h3>2. Pricing & size</h3>
    <p class="section-subtext">Share the deposit, footprint and daily/weekly/monthly rates you want to accept.</p>
    <div class="field-grid columns-2">
      <label class="field-option">
        <span class="status-dot" aria-hidden="true"></span>
        <div class="field-content">
          <span class="field-title">Deposit (USDC)</span>
          <span class="field-hint">Escrowed upfront and released after platform approval.</span>
          <input id="deposit" placeholder="100.00" inputmode="decimal">
        </div>
      </label>
      <label class="field-option">
        <span class="status-dot" aria-hidden="true"></span>
        <div class="field-content">
          <span class="field-title">Property size (m²)</span>
          <span class="field-hint">Square metre footprint used when tokenising bookings.</span>
          <input id="areaSqm" placeholder="85" inputmode="numeric">
        </div>
      </label>
    </div>
    <div class="field-grid columns-3">
      <label class="field-option">
        <span class="status-dot" aria-hidden="true"></span>
        <div class="field-content">
          <span class="field-title">Daily (USDC)</span>
          <span class="field-hint">Enter 0 to disable daily pricing.</span>
          <input id="rateDaily"  value="0" inputmode="decimal">
        </div>
      </label>
      <label class="field-option">
        <span class="status-dot" aria-hidden="true"></span>
        <div class="field-content">
          <span class="field-title">Weekly (USDC)</span>
          <span class="field-hint">Enter 0 to disable weekly pricing.</span>
          <input id="rateWeekly" value="0" inputmode="decimal">
        </div>
      </label>
      <label class="field-option">
        <span class="status-dot" aria-hidden="true"></span>
        <div class="field-content">
          <span class="field-title">Monthly (USDC)</span>
          <span class="field-hint">Enter 0 to disable monthly pricing.</span>
          <input id="rateMonthly" value="0" inputmode="decimal">
        </div>
      </label>
    </div>
  </div>

  <div class="guided-section">
    <h3>3. Booking policies</h3>
    <p class="section-subtext">Control how soon tenants can book and how far in advance your calendar opens.</p>
    <div class="field-grid columns-2">
      <label class="field-option">
        <span class="status-dot" aria-hidden="true"></span>
        <div class="field-content">
          <span class="field-title">Min booking notice (hours)</span>
          <span class="field-hint">Minimum time before check-in that bookings are allowed.</span>
          <input id="minNotice" value="24" inputmode="numeric">
        </div>
      </label>
      <label class="field-option">
        <span class="status-dot" aria-hidden="true"></span>
        <div class="field-content">
          <span class="field-title">Booking window (days, 0 = none)</span>
          <span class="field-hint">How far into the future tenants can reserve.</span>
          <input id="maxWindow" value="90" inputmode="numeric">
        </div>
      </label>
    </div>
    <div class="muted"><small>Adjust how soon and how far ahead tenants can reserve.</small></div>
  </div>

  <div class="guided-section">
    <h3>4. Metadata (optional)</h3>
    <p class="section-subtext">Leave blank and we’ll generate a JSON payload with your inputs.</p>
    <div class="field-grid">
      <label class="field-option">
        <span class="status-dot" aria-hidden="true"></span>
        <div class="field-content">
          <span class="field-title">Metadata URL (optional)</span>
          <span class="field-hint">Provide hosted JSON if you manage metadata externally. Leave blank and we’ll auto-generate it.</span>
          <input id="metadataUrl" placeholder="https://example.com/listing.json">
        </div>
      </label>
    </div>
  </div>

  <div class="muted" style="margin-top:16px;"><small class="mono">Listings deploy via the Platform contract. Your wallet address becomes the landlord.</small></div>

  <button id="create" disabled>Create Listing</button>
  <div id="status"></div>

  <div class="divider"></div>
  <h2>Your Listings</h2>
  <div class="muted"><small>Check availability for each listing below.</small></div>
  <div id="listingControls" class="listing-controls" hidden>
    <label>
      <span>Sort by</span>
      <select id="listingSort">
        <option value="created-desc">Newest → Oldest</option>
        <option value="created-asc">Oldest → Newest</option>
        <option value="price-asc">Base price: Low → High</option>
        <option value="price-desc">Base price: High → Low</option>
      </select>
    </label>
    <label>
      <span>Location filter</span>
      <input id="listingLocationFilter" placeholder="Geohash prefix or lat,lon" autocomplete="off" spellcheck="false" />
    </label>
    <button type="button" id="listingLocationClear" class="inline-button">Clear</button>
  </div>
  <div id="landlordListings" class="muted">Connect wallet to load your listings.</div>

  <footer>
    r3nt by SQMU. USDC. Arbitrum.
  </footer>

  <script type="module" src="./js/landlord.js"></script>
</body>
</html>
